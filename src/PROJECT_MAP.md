Перед выполнением любой работы ОБЯЗАТЕЛЬНО прочитай PROJECT_MAP.md.

Цель:
Использовать PROJECT_MAP.md как единственный источник структуры проекта,
сохраняя минимальный трафик.

Правила:
1. Репозиторий целиком НЕ сканировать.
2. Работать только по информации из PROJECT_MAP.md.
3. Если информация в карте неточна, действовать строго по правилам ниже.

Коррекция карты:
- Если обнаружена мелкая неточность —
  обнови описание в PROJECT_MAP.md без дополнительного поиска.
- Если нужного файла нет в карте —
  разрешён ОДИН точечный поиск (одна папка или один запрос),
  после чего ОБЯЗАТЕЛЬНО обнови PROJECT_MAP.md.
- Если расхождение то актуализируй PROJECT_MAP.md.

Формат ответа СТРОГО:
PLAN
COMMANDS
DONE

Никаких объяснений, рассуждений и лишнего вывода.


# PROJECT_MAP.md

## Общая информация
Проект: Embedded/IoT проект на PlatformIO (ESP/Arduino-класс устройств).
Назначение: работа с датчиками, UI (Nextion), MQTT, Modbus RTU (RS485), Web-интерфейс, LED WS2815.

---

## Структура репозитория

### Корень проекта
- `platformio.ini` — конфигурация PlatformIO (платы, фреймворк, библиотеки).
- `README.md` — общее описание проекта.
- `data/` — статические файлы для файловой системы устройства (изображения).
  - `Basin.jpg`
  - `anim1.gif`
  - `img1.jpg`
  - `img2.jpg`
- `lib/` — сторонние библиотеки (PlatformIO/Arduino).
  - `Adafruit ADS1X15/`
  - `Adafruit BusIO/`
  - `DallasTemperature/`
  - `Easy Nextion Library/`
  - `OneWire-2.3.7/`
  - `eModbus/`
  - `Conad_GitHub.txt` — примечание/метаданные.
  - `ESP32-S3.jpg` — изображение/справочный файл.

---

## src/

### Точка входа
- `src/main.cpp`
  Главный файл прошивки.
  Инициализация модулей, setup/loop, связывание подсистем.

---

### Датчики и измерения
- `src/ds18.h` — датчик температуры DS18B20.
- `src/NPT_Time.h` — работа со временем / NTP / тайминг.
- `src/PH_CL2.h` — датчики pH / CL2 (хлор).
- `src/Slow.h` — медленные/фоновые измерения.

---

### Связь и протоколы
- `src/settings_MQTT.h` — настройки MQTT (сервер, топики, авторизация).
- `src/ModbusRTU_RS485.h` — Modbus RTU по RS485.
- `src/wifi_manager.h` — подключение и управление Wi‑Fi.

---

### UI / Nextion
- `src/Nextion_Rx.h` — приём данных от дисплея Nextion.
- `src/Nextion_Tx.h` — отправка данных на Nextion.
- `src/interface - JeeUI2.h` — логика интерфейса.
- `src/ui - JeeUI2.h` — UI-уровень, экраны, элементы.

---

### Web
- `src/web.h` — веб-интерфейс (страницы, API).
- `src/WebUpdate.h` — OTA / обновление прошивки через Web.

---

### LED
- `src/LED_WS2815.h` — управление адресной LED-лентой WS2815.

---

### Таймеры и логика
- `src/Timer_Relay.h` — таймеры, реле, задержки.

---

### Внутренние утилиты
- `src/fs_utils.h` — работа с файловой системой.
- `src/graph.h` — графики / визуализация данных.
- `src/GradientPalettes.h` — цветовые палитры / градиенты.

---

## Правила работы для Codex / AI
- **Запрещено** сканировать весь репозиторий.
- Использовать эту карту как основной источник структуры.
- Поиск (`rg`, `grep`) — только по файлам, указанным выше.
- При добавлении новых файлов — обновлять `PROJECT_MAP.md`.

---

## Рекомендованный минимальный workflow (экономия трафика)
1. Прочитать `src/PROJECT_MAP.md`.
2. Открывать **только** конкретные файлы из списка выше.
3. Если файл отсутствует в карте — выполнить **один** точечный поиск:
   - `ls <папка>` или `rg --files -g '<имя_файла>'`
4. Сразу обновить `src/PROJECT_MAP.md` при любом несоответствии.
5. Избегать команд типа `find`/`ls -R`/глобальных `rg` по всему репозиторию.

---

## Команды сборки (PlatformIO)

- Сборка: `pio run`
- Загрузка: `pio run -t upload`
- Монитор: `pio device monitor`

---

## Примечания
Этот файл используется как "память проекта" для AI и должен поддерживаться в актуальном состоянии.



